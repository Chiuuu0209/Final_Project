<!DOCTYPE html>
<html>
    <head> 
        <meta charset="utf-8">
        <script src="static/jquery.js"></script>
    </head>
    <body>
        <div>
            <button>登入</button>
        </div>
        <div>
            <button>註冊</button>
        </div>

        <textarea readonly id="chat-log" cols="100" rows="20"></textarea><br/>
        <input id="chat-message-input" type="text" size="100"/><br/>
        <input id="chat-message-submit" type="button" value="Send"/>
    
    </body>

</html>

<script>
    $.ajaxSetup({
        data:{csrfmiddlewaretoken:'{{ csrf_token }}'}
    })

    $(document).ready(function() {
        update_msg();
        setInterval(update_msg, 200);
    });

    $("#chat-message-submit").click( function() {
        $.ajax({
              url: '/chat_update',
              method: 'POST',
              type: 'POST',
              dataType: "json",
              data: {
                  "post_type": "Send",
                  "text": document.getElementById("chat-message-input").value
              },
              success: function (data) {
                if (data.result == "success"){
                  //alert("Success!");
                  update_msg();
                }
              }
        });
    });

    function update_msg(){
        $.ajax({
              url: '/chat_update',
              method: 'POST',
              type: 'POST',
              dataType: "json",
              data: {
                  "post_type": "Receive",
              },
              success: function (data) {
                if (data.result == "success"){
                  //alert("Success!");
                  var html_code = ""
                  for(var i = 0; i < data.msg.length; i++){
                      html_code += data.msg[i];
                  }
                  $("#chat-log").html(html_code);
                }
              }
        });
    };

    

</script>